---
tags:
  - study
  - 이펙티브자바
title: 예외는 진짜 예외 상황에만 사용하라
chapter: 아이템 69
---
## 예외는 진짜 예외 상황에만 사용하라

### 핵심
- 예외는 예외 상황에서 쓸 의도로 설계되었다. 정상적인 제어 흐름에서 사용해서는 안되며, 이를 프로그래머에게 강요하는 `API`를 만들어서도 안된다.
### 예외를 완전 잘 못 사용한 예
```java
// 69-1
try {
  int i = 0;

  while(true) {
    range[i++].climb();
  }
} catch (ArrayIndexOutOfBoundsException e) {

}
```
- 이 코드는 무한루프를 돌다가 배열의 끝에 도달해 `ArrayIndexOutOfBoundsException` 이 발생하면 끝을내는 코드이다.
- `JVM`은 배열에 접근할 때마다 경계를 넘지 않는지 검사하는데, 일반적인 반복문도 배열 경계에 도달하면 종료한다. 따라서 이 검사를 반복문에도 명시하면 같은일이 중복되느로 생략한것이다.
- 결과적으로 잘못된 추론을 근거로 성능을 높이려 한것이다.

### 잘못된 추론
- 예외는 예외 상황에 쓸 용도로 설계되었다. `JVM` 구현자 입장에서는 명확한 검사만큼 빠르게 만들어야 할 이유가 없다.
- 코드를 `try-catch` 블록안에 넣으면 `JVM`이 적용할 수 있는 최적화가 제한된다.
- 배열을 순회하는 표준 관용구는 앞서 걱정한 중복검사를 수행하지 않는다. `JVM` 이 알아서 최적화해 없애준다.

### 예외를 사용한 반복문의 해악
- 성능을 떨어뜨리는게 끝이 아니라 재대로 동작하지 않을 수 있다.
- 예외를 사용한 반복문은 버그 때문에 발생한 엉뚱한 예외를 정상적인 반복문 종료 상황으로 오해하고 넘어갈 수 있다.
### 교훈
- 예외는 오직 예외 상황에서만 써야한다. 절대로 일상적인 제어 흐름용으로 쓰여선 안된다.
	- 실제로 성능이 좋아지더라도 최적화로 얻은 상대적인 성능우위는 오래가지 않을 수 있다.
- 잘설계된 `API`라면 클라이언트가 정상적인 제어 흐름에서 예외를 사용할일이 없게 해야한다.
	- 상태 의존적 메서드라면 상태 검사 메서드도 동시에 제공해야한다.
### 상태검사 메서드, 옵셔널, 특정 값중 하나를 선택하는 지침
- 외부 요인으로 상태가 변할 수 있다면 `optional` 혹은 특정값.
	- 상태 검사 메서드와 상태 의존적 메서드 호출 사이에 객체 상태가 변할 수 있다.
- 성능이 중요한데 상태검사 메서드가 상태 의존적 메서드의 작업 일부를 수행한다면 `optional` 혹은 특정값.
- 다른 모든 경우엔 상태 검사 메서드 방식이 조금 더 낫다.
	- 가독성이 좋고 잘못을 발견하기 쉽다.
	- 상태검사 메서드 호출을 잊었다면 상태 의존적 메서드가 예외를 던져서 버그를 확실히 드러낸다.
	- 특정 값은 검사하지 않고 지나쳐도 발견하기 어렵다.